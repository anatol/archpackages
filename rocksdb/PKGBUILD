# Maintainer: Anatol Pomozov <anatol.pomozov@gmail.com>

pkgname=rocksdb
pkgver=2.8
pkgrel=1
pkgdesc='Embedded key-value store for fast storage'
arch=(i686 x86_64)
url='http://rocksdb.org'
license=(BSD)
depends=(gflags)
checkdepends=(python2)
backup=()
source=(
  https://github.com/facebook/rocksdb/archive/$pkgver.fb.zip
)
sha256sums=('6fa94452c9c528ae2754f979675e40cb8afbb4a5f05262fe3e29a419bb7e8fb8')

prepare() {
  cd $pkgname-$pkgver.fb
  sed -e 's/\bpython\b/python2/' -i Makefile
}

build() {
  cd $pkgname-$pkgver.fb
  make librocksdb.so
}

# The are some tests are broken in 2.6 release
#check() {
#  cd $pkgname-$pkgver.fb
#  make check
#}

package() {
  cd $pkgname-$pkgver.fb
  install -d "$pkgdir"/usr/include/rocksdb
  install -m644 -t "$pkgdir"/usr/include/rocksdb include/rocksdb/*
  install -m755 -D librocksdb.so "$pkgdir"/usr/lib/librocksdb.so
}
