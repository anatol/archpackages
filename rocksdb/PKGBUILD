# Maintainer: Anatol Pomozov <anatol.pomozov@gmail.com>

pkgname=rocksdb
pkgver=2.6
pkgrel=1
pkgdesc='Embedded key-value store for fast storage'
arch=(i686 x86_64)
url='http://rocksdb.org'
license=(BSD)
depends=(gflags)
checkdepends=(python2)
backup=()
source=(
  https://github.com/facebook/rocksdb/archive/$pkgver.fb.zip
  fix_compile_error.diff
)
sha256sums=('85f75ad4a24b0f6b85700db57a333b3541944a0a1190e178d1231a0e552998d4'
            '92ea39503bb02e15be38132214e715a41f815354fdd1b578cf4fbd42b7e2d1e3')

prepare() {
  cd $pkgname-$pkgver.fb
  patch -p1 < ../fix_compile_error.diff

  sed -e 's/\bpython\b/python2/' -i Makefile
}

build() {
  cd $pkgname-$pkgver.fb
  make all librocksdb.so
}

# The are some tests are broken in 2.6 release
#check() {
#  cd $pkgname-$pkgver.fb
#  make check
#}

package() {
  cd $pkgname-$pkgver.fb
  make DESTDIR="$pkgdir" install
}
