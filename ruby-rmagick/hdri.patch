From 689271fbb439dbf735f120811ac3b2dc79ba95a2 Mon Sep 17 00:00:00 2001
From: Brice Fernandes <brice.fernandes@gmail.com>
Date: Mon, 19 Aug 2013 03:02:54 +0100
Subject: [PATCH] Attempt to fix bug #18 in original repo. (to enable Ruby
 bundling on Arch Linux)

---
 ext/RMagick/extconf.rb | 8 --------
 ext/RMagick/rmimage.c  | 2 +-
 2 files changed, 1 insertion(+), 9 deletions(-)

diff --git a/ext/RMagick/extconf.rb b/ext/RMagick/extconf.rb
index d3228dd..b6a1f04 100644
--- a/ext/RMagick/extconf.rb
+++ b/ext/RMagick/extconf.rb
@@ -152,14 +152,6 @@ def check_partial_imagemagick_versions()
 
   $magick_version = `Magick-config --version`.chomp
 
-  # Ensure ImageMagick is not configured for HDRI
-  unless checking_for("HDRI disabled version of ImageMagick") do
-    not (`Magick-config --version`["HDRI"])
-  end
-    exit_failure "\nCan't install RMagick #{RMAGICK_VERS}."+
-           "\nRMagick does not work when ImageMagick is configured for High Dynamic Range Images."+
-           "\nDon't use the --enable-hdri option when configuring ImageMagick.\n"
-  end
 
   # Save flags
   $CFLAGS     = ENV["CFLAGS"].to_s   + " " + `Magick-config --cflags`.chomp
diff --git a/ext/RMagick/rmimage.c b/ext/RMagick/rmimage.c
index 64de23a..4ecd117 100644
--- a/ext/RMagick/rmimage.c
+++ b/ext/RMagick/rmimage.c
@@ -9819,7 +9819,7 @@ VALUE Image_filesize(VALUE self)
 #else
             IndexPacket *indexes = GetIndexes(image);
 #endif
-            old_color = image->colormap[*indexes];
+            old_color = image->colormap[(unsigned long)*indexes];
         }
         if (!image->matte)
         {
-- 
1.8.4
